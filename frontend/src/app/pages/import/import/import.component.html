<div class="page-container">
  <div class="page-header">
    <h1>Import Data</h1>
  </div>

  <mat-tab-group>
    <!-- Import Students Tab -->
    <mat-tab label="Import Students">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Import Students</mat-card-title>
            <mat-card-subtitle>Upload a CSV file to import students</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="import-instructions">
              <mat-icon>info</mat-icon>
              <div>
                <p><strong>Instructions:</strong></p>
                <ul>
                  <li>Download the template file and fill in your data</li>
                  <li>Ensure all required fields are filled</li>
                  <li>Save as CSV format</li>
                  <li>Upload the file below</li>
                </ul>
              </div>
            </div>

            <button mat-raised-button (click)="downloadTemplate(ImportType.STUDENTS)">
              <mat-icon>download</mat-icon>
              Download Template
            </button>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>School Year</mat-label>
              <mat-select [(ngModel)]="selectedSchoolYearId">
                <mat-option *ngFor="let year of schoolYears" [value]="year.id">
                  {{ year.year }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <div class="file-upload">
              <input 
                type="file" 
                accept=".csv"
                (change)="handleFileInput($event, ImportType.STUDENTS)"
                #fileInputStudents
                style="display: none;">
              
              <button mat-raised-button color="accent" (click)="fileInputStudents.click()">
                <mat-icon>upload_file</mat-icon>
                Choose CSV File
              </button>

              <span class="file-name" *ngIf="selectedFile">{{ selectedFile.name }}</span>
            </div>

            <div class="validation-result" *ngIf="validation && currentImportType === ImportType.STUDENTS">
              <div class="validation-header" [class.valid]="validation.isValid" [class.invalid]="!validation.isValid">
                <mat-icon>{{ validation.isValid ? 'check_circle' : 'error' }}</mat-icon>
                <span>{{ validation.isValid ? 'File is valid' : 'Validation errors found' }}</span>
              </div>

              <div class="errors" *ngIf="validation.errors && validation.errors.length > 0">
                <h4>Errors:</h4>
                <ul>
                  <li *ngFor="let error of validation.errors">
                    Row {{ error.row }}: {{ error.message }}
                  </li>
                </ul>
              </div>

              <div class="preview" *ngIf="validation.preview">
                <h4>Preview (first 10 rows):</h4>
                <table class="preview-table">
                  <thead>
                    <tr>
                      <th *ngFor="let header of validation.preview.headers">{{ header }}</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let row of validation.preview.rows">
                      <td *ngFor="let cell of row">{{ cell }}</td>
                    </tr>
                  </tbody>
                </table>
                <p class="total-rows">Total rows: {{ validation.preview.totalRows }}</p>
              </div>
            </div>

            <mat-progress-bar mode="indeterminate" *ngIf="importing"></mat-progress-bar>
          </mat-card-content>

          <mat-card-actions>
            <button 
              mat-raised-button 
              color="primary"
              [disabled]="!validation || !validation.isValid || importing || currentImportType !== ImportType.STUDENTS"
              (click)="performImport(ImportType.STUDENTS)">
              {{ importing ? 'Importing...' : 'Import Data' }}
            </button>
            <button mat-button (click)="reset()" [disabled]="importing">
              Reset
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Import Teachers Tab -->
    <mat-tab label="Import Teachers">
      <!-- Similar structure as Students Tab -->
    </mat-tab>

    <!-- Import Projects Tab -->
    <mat-tab label="Import Projects">
      <!-- Similar structure as Students Tab -->
    </mat-tab>

    <!-- Import History Tab -->
    <mat-tab label="Import History">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Import History</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="importLogs" class="full-width">
              <ng-container matColumnDef="fileName">
                <th mat-header-cell *matHeaderCellDef>File Name</th>
                <td mat-cell *matCellDef="let log">{{ log.fileName }}</td>
              </ng-container>

              <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let log">{{ log.type }}</td>
              </ng-container>

              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let log">
                  <span class="status-badge" [class]="'status-' + log.status.toLowerCase()">
                    {{ log.status }}
                  </span>
                </td>
              </ng-container>

              <ng-container matColumnDef="records">
                <th mat-header-cell *matHeaderCellDef>Records</th>
                <td mat-cell *matCellDef="let log">
                  {{ log.successfulRecords }}/{{ log.totalRecords }}
                </td>
              </ng-container>

              <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Date</th>
                <td mat-cell *matCellDef="let log">{{ log.startedAt | date:'short' }}</td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>

            <div class="no-data" *ngIf="importLogs.length === 0">
              <mat-icon>history</mat-icon>
              <p>No import history</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
